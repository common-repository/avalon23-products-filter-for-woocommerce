'use strict';class Av23ImageMap{constructor(a="",b={},c,d="",e="",f="",g={}){this.prefix="avalon23-",this.is_empty=!0,this.unique_id=this.create_id(),this.filter_key=a,this.filter_data=c,this.main_img=d,this.marker_img=e,this.marker_checked_img=f,this.options=b,this.multiple=1,"undefined"!=typeof g.multiple&&(this.multiple=g.multiple),this.show_count=1,"undefined"!=typeof g.show_count&&(this.show_count=g.show_count),this.hide_empty_terms=0,this.show_scale_menu=1,"undefined"!=typeof g.show_scale_menu&&(this.show_scale_menu=g.show_scale_menu),this.show_expand_menu=1,"undefined"!=typeof g.show_expand_menu&&(this.show_expand_menu=g.show_expand_menu),this.filter_id="av23"+this.create_id(),"undefined"!=typeof g.filter_id&&(this.filter_id=g.filter_id),this.map=this.create_map(),this.container=this.create_container()}create_container(){let a=document.createElement("div");return a.className=this.prefix+"image-map-container",a}create_map(){let a=document.createElement("div");a.className=this.prefix+"image-map-main";let b=document.createElement("img");return b.setAttribute("src",this.main_img),b.setAttribute("alt",this.filter_key),b.className=this.prefix+"image-map-main-img",a.appendChild(b),a}create_id(){let a="_"+Math.random().toString(36).substr(2,4);return a}draw(){if(!this.main_img)return null;let a=document.createElement("div");if(a.className=this.prefix+"image-map-wraper",this.add_markers(),this.is_empty)return null;let b=this.create_menu();return b&&this.container.appendChild(b),a.appendChild(this.map),this.container.appendChild(a),this.init_filter(),this.container}init_filter(){let a=this.container.querySelectorAll(".avalon23-marker-input");for(let b,c=0;c<a.length;c++)b=a[c].checked,a[c].addEventListener("click",()=>{if(a[c].disabled)return;let d=[];b&&0==this.multiple&&(a[c].checked=!1),Array.from(a).forEach(function(a){a.checked&&d.push(a.value)}),this.filter_data[this.filter_key]=d.join(","),0===d.length&&delete this.filter_data[this.filter_key],this.do_filter()})}do_filter(){console.log(this.filter_data)}add_markers(){this.is_empty=!0;for(let a,b=0;b<this.options.length;b++)if(a=document.createElement("div"),a.className=this.prefix+"image-map-marker avalon23-image-map-"+this.options[b].id,this.options[b].top&&this.options[b].left){a.style.top=this.options[b].top+"%",a.style.left=this.options[b].left+"%",a.setAttribute(this.prefix+"data-tooltip",this.options[b].title),23>this.options[b].top?a.setAttribute(this.prefix+"data-tooltip-location","bottom"):7>this.options[b].left?a.setAttribute(this.prefix+"data-tooltip-location","right"):93<this.options[b].left&&a.setAttribute(this.prefix+"data-tooltip-location","left");let c=document.createElement("label"),d=document.createElement("input");if(d.className=this.prefix+"marker-input",d.id=this.prefix+"marker_"+this.options[b].id+this.unique_id,c.setAttribute("for",this.prefix+"marker_"+this.options[b].id+this.unique_id),parseInt(this.multiple)?d.setAttribute("type","checkbox"):(d.setAttribute("type","radio"),d.setAttribute("name","radio"+this.filter_key+this.filter_id)),d.setAttribute("value",this.options[b].id),d.setAttribute("data-key",this.filter_key),this.filter_data[this.filter_key]){let a=this.filter_data[this.filter_key].split(",");a.includes(this.options[b].id+"")&&(d.checked=!0,this.options[b].count=-1)}let e=document.createElement("img");e.className=this.prefix+"image-map-img-marker",e.setAttribute("src",this.marker_img),e.setAttribute("alt",this.options[b].title);let f=document.createElement("img");if(f.className=this.prefix+"image-map-img-marker-checked",f.setAttribute("src",this.marker_checked_img),f.setAttribute("alt",this.options[b].title),c.appendChild(e),c.appendChild(f),this.show_count&&-1!=this.options[b].count){let a=document.createElement("p");a.className=this.prefix+"image-map-count",a.innerText=this.options[b].count,c.appendChild(a)}a.appendChild(d),a.appendChild(c),0==this.options[b].count&&(d.setAttribute("disabled","disabled"),e.style.opacity="0.4"),this.is_empty=!1,this.map.appendChild(a)}}create_menu(){if(!this.show_expand_menu&&!this.show_scale_menu)return null;let a=document.createElement("div");if(a.className=this.prefix+"image-map-menu",this.show_scale_menu){let b=document.createElement("div");b.addEventListener("click",()=>{this.image_map_scale("+")}),b.className=this.prefix+"image-map-menu-item "+this.prefix+"image-map-scale-plus";let c=document.createElement("span");c.className="dashicons dashicons-insert",b.appendChild(c);let d=document.createElement("div");d.addEventListener("click",()=>{this.image_map_scale("-")}),d.className=this.prefix+"image-map-menu-item "+this.prefix+"image-map-scale-minus";let e=document.createElement("span");e.className="dashicons dashicons-remove",d.appendChild(e),a.appendChild(b),a.appendChild(d)}if(this.show_expand_menu){let b=document.createElement("div");b.addEventListener("click",()=>{this.image_map_expand()}),b.className=this.prefix+"image-map-menu-item "+this.prefix+"image-map-scale-expand";let c=document.createElement("span");c.className="dashicons dashicons-editor-expand";let d=document.createElement("span");d.className="dashicons dashicons-editor-contract",b.appendChild(c),b.appendChild(d),a.appendChild(b)}return a}image_map_scale(a){let b=this.map;if("+"==a){let a=1.2*b.clientWidth,c=1.2*b.clientHeight;b.style.width=a+"px",b.style.height=c+"px"}else{let a=.8*b.clientWidth,c=.8*b.clientHeight;175<a&&(b.style.width=a+"px",b.style.height=c+"px")}this.image_map_resize()}image_map_resize(){let a=this.map.querySelectorAll("."+this.prefix+"image-map-count");for(let b,c=0;c<a.length;c++)b=.4*a[c].clientHeight,a[c].style.fontSize=b+"px"}image_map_expand(){let a=this.container;a.classList.toggle(this.prefix+"image-map-expanded"),this.image_map_resize()}}